"use strict";var y=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(t,o)=>{for(var r in o)y(t,r,{get:o[r],enumerable:!0})},T=(t,o,r,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of D(o))!k.call(t,e)&&e!==r&&y(t,e,{get:()=>o[e],enumerable:!(s=v(o,e))||s.enumerable});return t};var P=t=>T(y({},"__esModule",{value:!0}),t);var O={};A(O,{DEFAULT_OPTIONS:()=>m,LanyardError:()=>b,SocketEvents:()=>L,SocketOpcode:()=>w,get:()=>_,getURL:()=>S,useLanyard:()=>R,useLanyardWS:()=>h});module.exports=P(O);var p=require("react");var g=require("react");function E(){return(0,g.useContext)(I)}var I=(0,g.createContext)({listeners:new Set,stateMap:new Map});var m={api:{hostname:"api.lanyard.rest",secure:!0}};function S(t,o){return`${o.api.secure?"https":"http"}://${o.api.hostname}/v1/users/${t}`}async function _(t,o){let r={method:"GET",signal:o.controller?.signal??null,headers:{Accept:"application/json"}},s=new Request(t,r),e=await fetch(s),c=await e.json();return c.success?{success:!0,data:c.data}:{success:!1,error:new b(s,e,c)}}var b=class extends Error{constructor(r,s,e){super(e.error.message);this.request=r;this.response=s;this.body=e;this.code=this.response.status}code};function R(t,o){let r={...m,...o},[,s]=(0,p.useState)({}),e=E();e.stateMap.has(t)||e.stateMap.set(t,{state:"initial",isLoading:!1,data:r.initialData,error:void 0});let c=n=>{e.stateMap.set(t,n);for(let i of e.listeners)i()},l=()=>{let n=e.stateMap.get(t);if(!n)throw new Error("State not found");return n},u=n=>{c({...l(),isLoading:n})},d=S(t,r),a=(0,p.useCallback)(async n=>{if(l().isLoading)return;u(!0);let i=await _(d,n?{...r,controller:n}:r);i.error?c({...l(),state:"errored",error:i.error,isLoading:!1}):c({...l(),state:"loaded",data:i.data,isLoading:!1})},[d]);return(0,p.useEffect)(()=>{let n=()=>s({});e.listeners.add(n);let i=new AbortController;return a().finally(()=>{u(!1)}),()=>{i.abort(),e.listeners.delete(n)}},[a]),{...l(),revalidate:(0,p.useCallback)(()=>a(),[a])}}var x=require("react");var w=(e=>(e[e.Event=0]="Event",e[e.Hello=1]="Hello",e[e.Initialize=2]="Initialize",e[e.Heartbeat=3]="Heartbeat",e))(w||{}),L=(r=>(r.INIT_STATE="INIT_STATE",r.PRESENCE_UPDATE="PRESENCE_UPDATE",r))(L||{});function h(t,o){let r={...m,...o},[s,e]=(0,x.useState)(),l=`${r.api.secure?"wss":"ws"}://${r.api.hostname}/socket`;return(0,x.useEffect)(()=>{if(typeof window>"u")return;if(!("WebSocket"in window||"MozWebSocket"in window))throw new Error("WebSocket connections not supported in this browser.");let u;typeof t=="object"?u={subscribe_to_ids:t}:u={subscribe_to_id:t};let d,a;function n(){d&&clearInterval(d),a=new WebSocket(l),a.addEventListener("open",()=>{console.log("Lanyard: Socket connection opened")}),a.addEventListener("close",n),a.addEventListener("message",i=>{let f=JSON.parse(i.data);switch(f.op){case 1:{d=setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({op:3}))},f.d?.heartbeat_interval),a.readyState===a.OPEN&&a.send(JSON.stringify({op:2,d:u}));break}case 0:{switch(f.t){case"INIT_STATE":case"PRESENCE_UPDATE":{f.d&&e(f.d);break}default:break}break}default:break}})}return n(),()=>{clearInterval(d),a.removeEventListener("close",n),a.close()}},[l]),s??r.initialData}0&&(module.exports={DEFAULT_OPTIONS,LanyardError,SocketEvents,SocketOpcode,get,getURL,useLanyard,useLanyardWS});
//# sourceMappingURL=index.js.map